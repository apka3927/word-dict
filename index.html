<!doctype html>
<html lang="ko" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ë‹¨ì–´ ì‚¬ì „ â€” ë“±ë¡ & ê²€ìƒ‰</title>

    <!-- Tailwind CDN (dark mode: class) -->
    <script>tailwind = { config: { darkMode: 'class' } };</script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React 18 UMD + ReactDOM + Babel(ë¸Œë¼ìš°ì € JSX ë³€í™˜) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="h-full">
    <div id="root"></div>

    <!-- ì•± ì½”ë“œ: ìˆœìˆ˜ JS(íƒ€ì… ì—†ìŒ) -->
    <script type="text/babel">
      const { useEffect, useMemo, useState } = React;
      const CATEGORIES = ["ìˆëŠ”ë§", "ìˆë˜ë§", "ë§Œë“ ë§"];

      function WordRegistry() {
        // ë‹¤í¬ ëª¨ë“œ
        const [dark, setDark] = useState(() => {
          const saved = localStorage.getItem('dict.dark');
          if (saved === null) {
            return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          }
          return saved === '1';
        });
        useEffect(() => {
          document.documentElement.classList.toggle('dark', dark);
          localStorage.setItem('dict.dark', dark ? '1' : '0');
        }, [dark]);

        // ë°ì´í„°
        const [entries, setEntries] = useState(() => {
          try { return JSON.parse(localStorage.getItem('dict.entries.v1') || '[]'); } catch { return []; }
        });
        useEffect(() => {
          localStorage.setItem('dict.entries.v1', JSON.stringify(entries));
        }, [entries]);

        // í¼
        const [form, setForm] = useState({ word: '', meaning: '', category: CATEGORIES[0], method: '' });

        // ê²€ìƒ‰
        const [q, setQ] = useState('');
        const [cat, setCat] = useState('ì „ì²´'); // ì „ì²´ or ì¹´í…Œê³ ë¦¬

        const filtered = useMemo(() => {
          const term = q.trim().toLowerCase();
          return entries
            .filter(e => (cat === 'ì „ì²´' ? true : e.category === cat))
            .filter(e => {
              if (!term) return true;
              const hay = (e.word + '\n' + e.meaning + '\n' + e.method).toLowerCase();
              return hay.includes(term);
            })
            .sort((a,b) => b.ts - a.ts);
        }, [entries, q, cat]);

        function addEntry() {
          const word = form.word.trim();
          const meaning = form.meaning.trim();
          const method = form.method.trim();
          const category = form.category;

          if (!word || !meaning) return alert('ë‹¨ì–´ì™€ ëœ»ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
          if (!CATEGORIES.includes(category)) return alert('ë¶„ë¥˜ ì„ íƒì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');

          const dup = entries.some(e => e.word === word);
          if (dup && !confirm('ê°™ì€ ë‹¨ì–´ê°€ ì´ë¯¸ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ë„ ì¶”ê°€í• ê¹Œìš”?')) return;

          const id = (crypto?.randomUUID?.() || String(Date.now() + Math.random()));
          setEntries(prev => [{ id, word, meaning, category, method, ts: Date.now() }, ...prev]);
          setForm({ word: '', meaning: '', category: form.category, method: '' });
        }

        function removeEntry(id) {
          if (!confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?')) return;
          setEntries(prev => prev.filter(e => e.id !== id));
        }

        function onSubmit(e) {
          e.preventDefault();
          addEntry();
        }

        return (
          <div className="min-h-screen bg-gradient-to-b from-white to-slate-50 text-slate-900 dark:from-slate-950 dark:to-slate-900 dark:text-slate-100">
            {/* í—¤ë” */}
            <header className="sticky top-0 z-10 backdrop-blur bg-white/60 dark:bg-slate-900/60 border-b border-slate-200/60 dark:border-slate-800/60">
              <div className="mx-auto max-w-5xl px-4 py-3 flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="h-9 w-9 rounded-2xl bg-slate-900 dark:bg-slate-100 text-white dark:text-slate-900 grid place-items-center font-bold">ğŸ“š</div>
                  <div>
                    <h1 className="text-lg font-semibold">ë‹¨ì–´ ë“±ë¡Â·ê²€ìƒ‰</h1>
                    <p className="text-xs text-slate-600 dark:text-slate-400">ë‹¨ì–´/ëœ»/ë¶„ë¥˜/ë§Œë“ ë°©ë²• â€” ë¡œì»¬ ì €ì¥</p>
                  </div>
                </div>
                <button onClick={() => setDark(d => !d)} className="px-3 py-1.5 rounded-xl border border-slate-300 dark:border-slate-700 text-sm hover:bg-slate-100 dark:hover:bg-slate-800" aria-label="ë‹¤í¬ëª¨ë“œ">
                  {dark ? 'ğŸŒ™ ë‹¤í¬' : 'â˜€ï¸ ë¼ì´íŠ¸'}
                </button>
              </div>
            </header>

            <main className="mx-auto max-w-5xl px-4 py-8 grid lg:grid-cols-3 gap-6">
              {/* ì…ë ¥ í¼ */}
              <section className="lg:col-span-1 rounded-3xl border border-slate-200 dark:border-slate-800 bg-white/70 dark:bg-slate-900/70 p-5">
                <h2 className="font-semibold">ë‹¨ì–´ ë“±ë¡</h2>
                <p className="text-xs text-slate-600 dark:text-slate-400 mt-1">ì…ë ¥ í›„ "ì¶”ê°€"ë¥¼ ëˆ„ë¥´ì„¸ìš”.</p>

                <form onSubmit={onSubmit} className="mt-4 grid gap-3">
                  <Field label="ë‹¨ì–´">
                    <input
                      value={form.word}
                      onChange={(e) => setForm({ ...form, word: e.target.value })}
                      placeholder="ì˜ˆ: ì‚¬ê³¼"
                      className="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-400"
                      required
                    />
                  </Field>
                  <Field label="ëœ»">
                    <textarea
                      rows={3}
                      value={form.meaning}
                      onChange={(e) => setForm({ ...form, meaning: e.target.value })}
                      placeholder="ì˜ˆ: ì¥ë¯¸ê³¼ ì‚¬ê³¼ë‚˜ë¬´ì˜ ì—´ë§¤."
                      className="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-400"
                      required
                    />
                  </Field>
                  <Field label="ë¶„ë¥˜">
                    <select
                      value={form.category}
                      onChange={(e) => setForm({ ...form, category: e.target.value })}
                      className="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-400"
                    >
                      {CATEGORIES.map(c => <option key={c} value={c}>{c}</option>)}
                    </select>
                  </Field>
                  <Field label="ë§Œë“ ë°©ë²•">
                    <input
                      value={form.method}
                      onChange={(e) => setForm({ ...form, method: e.target.value })}
                      placeholder="ì˜ˆ: í•©ì„±(ì‚¬+ê³¼), ì°¨ìš©, ì¶•ì•½ ë“±"
                      className="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-400"
                    />
                  </Field>

                  <div className="flex items-center gap-2 pt-1">
                    <button type="submit" className="px-4 py-2 rounded-xl bg-emerald-500 text-white font-semibold hover:opacity-90">ì¶”ê°€</button>
                    <button type="button" onClick={() => setForm({ word: '', meaning: '', category: form.category, method: '' })} className="px-3 py-2 rounded-xl border border-emerald-500 text-emerald-600 dark:text-emerald-400 hover:bg-emerald-50/60 dark:hover:bg-emerald-900/20">ì´ˆê¸°í™”</button>
                  </div>
                </form>
              </section>

              {/* ê²€ìƒ‰/ë¦¬ìŠ¤íŠ¸ */}
              <section className="lg:col-span-2 space-y-4">
                <div className="rounded-3xl border border-slate-200 dark:border-slate-800 bg-white/70 dark:bg-slate-900/70 p-5">
                  <h2 className="font-semibold">ê²€ìƒ‰</h2>
                  <div className="mt-3 grid md:grid-cols-3 gap-3">
                    <input
                      value={q}
                      onChange={(e) => setQ(e.target.value)}
                      placeholder="ë‹¨ì–´/ëœ»/ë§Œë“ ë°©ë²• ê²€ìƒ‰..."
                      className="md:col-span-2 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-400"
                    />
                    <select
                      value={cat}
                      onChange={(e) => setCat(e.target.value)}
                      className="rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-400"
                    >
                      <option value="ì „ì²´">ì „ì²´</option>
                      {CATEGORIES.map(c => <option key={c} value={c}>{c}</option>)}
                    </select>
                  </div>
                  <div className="mt-2 text-xs text-slate-600 dark:text-slate-400">ì´ {entries.length}ê°œ ì¤‘ ê²€ìƒ‰ ê²°ê³¼ {filtered.length}ê°œ</div>
                </div>

                <ul className="grid md:grid-cols-2 gap-3">
                  {filtered.map(e => (
                    <li key={e.id} className="rounded-3xl border border-slate-200 dark:border-slate-800 bg-white/70 dark:bg-slate-900/70 p-5">
                      <div className="flex items-start justify-between gap-3">
                        <div>
                          <h3 className="text-lg font-semibold leading-tight">{e.word}</h3>
                          <div className="mt-1 text-xs text-slate-500 dark:text-slate-400">{new Date(e.ts).toLocaleString()}</div>
                        </div>
                        <span className="inline-flex items-center rounded-full border border-slate-200 dark:border-slate-700 px-2.5 py-1 text-xs bg-white/70 dark:bg-slate-900/70">{e.category}</span>
                      </div>
                      <p className="mt-3 text-sm text-slate-800 dark:text-slate-200 whitespace-pre-wrap">{e.meaning}</p>
                      {e.method && (
                        <div className="mt-2 text-xs text-slate-600 dark:text-slate-400">
                          <span className="font-medium">ë§Œë“ ë°©ë²•:</span> {e.method}
                        </div>
                      )}
                      <div className="mt-4 flex items-center gap-3">
                        <button onClick={() => removeEntry(e.id)} className="text-xs px-3 py-1.5 rounded-lg border border-rose-400 text-rose-600 dark:text-rose-400 hover:bg-rose-50/60 dark:hover:bg-rose-900/20">ì‚­ì œ</button>
                      </div>
                    </li>
                  ))}
                </ul>

                {filtered.length === 0 && (
                  <div className="rounded-3xl border border-dashed border-slate-300 dark:border-slate-700 p-8 text-center text-sm text-slate-500 dark:text-slate-400">
                    ì•„ì§ í•­ëª©ì´ ì—†ê±°ë‚˜ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ì™¼ìª½ í¼ì—ì„œ ìƒˆë¡œ ì¶”ê°€í•´ ë³´ì„¸ìš”.
                  </div>
                )}
              </section>
            </main>

            <footer className="mx-auto max-w-5xl px-4 py-10">
              <div className="rounded-3xl border border-slate-200 dark:border-slate-800 p-6 bg-white/70 dark:bg-slate-900/70 text-sm flex flex-col md:flex-row items-start md:items-center justify-between gap-3">
                <p>Â© {new Date().getFullYear()} ë‹¨ì–´ ë“±ë¡Â·ê²€ìƒ‰</p>
                <div className="flex gap-4 text-slate-600 dark:text-slate-300">
                  <a className="hover:underline" href="#">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
                  <a className="hover:underline" href="#">ì´ìš©ì•½ê´€</a>
                </div>
              </div>
            </footer>
          </div>
        );
      }

      function Field({ label, children }) {
        return (
          <label className="grid gap-1">
            <span className="text-xs font-medium text-slate-600 dark:text-slate-300">{label}</span>
            {children}
          </label>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<WordRegistry />);
    </script>
  </body>
</html>
